<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Canal Server Config" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="canal是一款MySQL增量日志解析并提供订阅&amp;消费消息中间件，通过配置canal伪装为MySQL的Slave节点，接收解析MySQL的同步日志将其转化为相应消息系统消息，原始使用场景是做为otter中间件的一部分，后来成为独立开源项目，已经贡献给Apache基金会。" /><meta property="og:description" content="canal是一款MySQL增量日志解析并提供订阅&amp;消费消息中间件，通过配置canal伪装为MySQL的Slave节点，接收解析MySQL的同步日志将其转化为相应消息系统消息，原始使用场景是做为otter中间件的一部分，后来成为独立开源项目，已经贡献给Apache基金会。" /><link rel="canonical" href="https://ohemin.github.io/posts/canal-server-config/" /><meta property="og:url" content="https://ohemin.github.io/posts/canal-server-config/" /><meta property="og:site_name" content="Hemin` Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-10-11T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Canal Server Config" /><meta name="twitter:site" content="@ohemin" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-01T10:20:29+08:00","datePublished":"2019-10-11T00:00:00+08:00","description":"canal是一款MySQL增量日志解析并提供订阅&amp;消费消息中间件，通过配置canal伪装为MySQL的Slave节点，接收解析MySQL的同步日志将其转化为相应消息系统消息，原始使用场景是做为otter中间件的一部分，后来成为独立开源项目，已经贡献给Apache基金会。","headline":"Canal Server Config","mainEntityOfPage":{"@type":"WebPage","@id":"https://ohemin.github.io/posts/canal-server-config/"},"url":"https://ohemin.github.io/posts/canal-server-config/"}</script><title>Canal Server Config | Hemin` Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Hemin` Blog"><meta name="application-name" content="Hemin` Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/assets/lib/fonts/main.css"><link rel="stylesheet" href="/assets/lib/bootstrap-4.6.1/bootstrap.min.css"><link rel="stylesheet" href="/assets/lib/fontawesome-free-5.15.4/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/lib/magnific-popup-1.1.0/magnific-popup.css"> <script src="/assets/lib/jquery-3.6.0/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" http://rcmxo16by.bkt.gdipper.com//assets/img/avatar.jpg " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hemin` Blog</a></div><div class="site-subtitle font-italic">Hemin's technology blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/ohemin" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/ohemin" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hemin.hz','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>Canal Server Config</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Canal Server Config</h1><div class="post-meta text-muted"><div> 作者 <em> <a href="https://twitter.com/MinHe15638041">Min He</a> </em></div><div class="d-flex"><div> <span> 发表于 <em class="timeago" data-ts="1570723200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2019-10-11 </em> </span> <span> 更新于 <em class="timeago" data-ts="1654050029" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-06-01 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="975 字"> <em>5 分钟</em>阅读</span></div></div></div><div class="post-content"><p>canal是一款MySQL增量日志解析并提供订阅&amp;消费消息中间件，通过配置canal伪装为MySQL的Slave节点，接收解析MySQL的同步日志将其转化为相应消息系统消息，原始使用场景是做为otter中间件的一部分，后来成为独立开源项目，已经贡献给Apache基金会。</p><p>canal常见使用场景有4种，除做为otter组件外，还可以做为</p><ol><li>缓存同步触发消息<li>自动填充数据库拉链表<li>做为实时统计数据源</ol><p>canal在大数据场景较为常用（上面第4个场景），通过订阅业务MySQL库的数据变更并转化为kafka消息，再由Flink计算程序进行实时计算，可以较好满足业务方实时数仓建设需求。</p><h2 id="拉取所需docker镜像"><span class="mr-2">拉取所需docker镜像</span><a href="#拉取所需docker镜像" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>这次在docker容器部署一个canal server做为开发环境</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>docker pull canal/canal-server
docker pull mysql_master:5.7.1
</pre></table></code></div></div><h2 id="在mysql中配置canal用户"><span class="mr-2">在MySQL中配置canal用户</span><a href="#在mysql中配置canal用户" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">exec</span> <span class="nt">-it</span> mysql_master bash
</pre></table></code></div></div><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">canal</span> <span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="s1">'canal'</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">SELECT</span><span class="p">,</span> <span class="k">SHOW</span> <span class="k">VIEW</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">SLAVE</span><span class="p">,</span> <span class="n">REPLICATION</span> <span class="n">CLIENT</span> <span class="k">ON</span> <span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="k">TO</span> <span class="s1">'canal'</span><span class="o">@</span><span class="s1">'%'</span><span class="p">;</span>
<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="启动canal-server"><span class="mr-2">启动canal server</span><a href="#启动canal-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>docker run <span class="nt">--name</span> canal-server <span class="se">\</span>
 <span class="nt">-e</span> canal.instance.master.address<span class="o">=</span>10.50.9.55:3406 <span class="se">\</span>
 <span class="nt">-e</span> canal.instance.dbUsername<span class="o">=</span>canal <span class="se">\</span>
 <span class="nt">-e</span> canal.instance.dbPassword<span class="o">=</span>canal <span class="se">\</span>
 <span class="nt">-p</span> 11111:11111 <span class="se">\</span>
 <span class="nt">-d</span> canal/canal-server:v1.1.4

./run_server.sh <span class="nt">-e</span> canal.admin.manager<span class="o">=</span>10.50.9.55:8089 <span class="se">\</span>
  <span class="nt">-e</span> canal.admin.port<span class="o">=</span>11110 <span class="se">\</span>
  <span class="nt">-e</span> canal.admin.user<span class="o">=</span>admin <span class="se">\</span>
  <span class="nt">-e</span> canal.admin.passwd<span class="o">=</span><span class="k">******</span>
</pre></table></code></div></div><h2 id="canalproperties"><span class="mr-2">canal.properties</span><a href="#canalproperties" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>也可以把配置写到配置文件中，然后启动时指定配置文件启动</p><div file="canal.properties" class="language-conf highlighter-rouge"><div class="code-header"> <span data-label-text="canal.properties"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre><td class="rouge-code"><pre><span class="c">#################################################
######### 		common argument		#############
#################################################
# tcp bind ip
</span><span class="n">canal</span>.<span class="n">ip</span> =
<span class="c"># register ip to zookeeper
</span><span class="n">canal</span>.<span class="n">register</span>.<span class="n">ip</span> =
<span class="n">canal</span>.<span class="n">port</span> = <span class="m">11111</span>
<span class="n">canal</span>.<span class="n">metrics</span>.<span class="n">pull</span>.<span class="n">port</span> = <span class="m">11112</span>
<span class="c"># canal instance user/passwd
</span><span class="n">canal</span>.<span class="n">user</span> = <span class="n">canal</span>
<span class="n">canal</span>.<span class="n">passwd</span> = <span class="n">E3619321C1A937C46A0D8BD1DAC39F93B27D4458</span>

<span class="c"># canal admin config
</span><span class="n">canal</span>.<span class="n">admin</span>.<span class="n">manager</span> = <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">8089</span>
<span class="n">canal</span>.<span class="n">admin</span>.<span class="n">port</span> = <span class="m">11110</span>
<span class="n">canal</span>.<span class="n">admin</span>.<span class="n">user</span> = <span class="n">admin</span>
<span class="n">canal</span>.<span class="n">admin</span>.<span class="n">passwd</span> = <span class="m">4</span><span class="n">ACFE3202A5FF5CF467898FC58AAB1D615029441</span>

<span class="n">canal</span>.<span class="n">zkServers</span> =
<span class="c"># flush data to zk
</span><span class="n">canal</span>.<span class="n">zookeeper</span>.<span class="n">flush</span>.<span class="n">period</span> = <span class="m">1000</span>
<span class="n">canal</span>.<span class="n">withoutNetty</span> = <span class="n">false</span>
<span class="c"># tcp, kafka, RocketMQ
</span><span class="n">canal</span>.<span class="n">serverMode</span> = <span class="n">tcp</span>
<span class="c"># flush meta cursor/parse position to file
</span><span class="n">canal</span>.<span class="n">file</span>.<span class="n">data</span>.<span class="n">dir</span> = ${<span class="n">canal</span>.<span class="n">conf</span>.<span class="n">dir</span>}
<span class="n">canal</span>.<span class="n">file</span>.<span class="n">flush</span>.<span class="n">period</span> = <span class="m">1000</span>
<span class="c">## memory store RingBuffer size, should be Math.pow(2,n)
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">memory</span>.<span class="n">buffer</span>.<span class="n">size</span> = <span class="m">16384</span>
<span class="c">## memory store RingBuffer used memory unit size , default 1kb
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">memory</span>.<span class="n">buffer</span>.<span class="n">memunit</span> = <span class="m">1024</span> 
<span class="c">## meory store gets mode used MEMSIZE or ITEMSIZE
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">memory</span>.<span class="n">batch</span>.<span class="n">mode</span> = <span class="n">MEMSIZE</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">memory</span>.<span class="n">rawEntry</span> = <span class="n">true</span>

<span class="c">## detecing config
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">detecting</span>.<span class="n">enable</span> = <span class="n">false</span>
<span class="c">#canal.instance.detecting.sql = insert into retl.xdual values(1,now()) on duplicate key update x=now()
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">detecting</span>.<span class="n">sql</span> = <span class="n">select</span> <span class="m">1</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">detecting</span>.<span class="n">interval</span>.<span class="n">time</span> = <span class="m">3</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">detecting</span>.<span class="n">retry</span>.<span class="n">threshold</span> = <span class="m">3</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">detecting</span>.<span class="n">heartbeatHaEnable</span> = <span class="n">false</span>

<span class="c"># support maximum transaction size, more than the size of the transaction will be cut into multiple transactions delivery
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">transaction</span>.<span class="n">size</span> =  <span class="m">1024</span>
<span class="c"># mysql fallback connected to new master should fallback times
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">fallbackIntervalInSeconds</span> = <span class="m">60</span>

<span class="c"># network config
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">network</span>.<span class="n">receiveBufferSize</span> = <span class="m">16384</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">network</span>.<span class="n">sendBufferSize</span> = <span class="m">16384</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">network</span>.<span class="n">soTimeout</span> = <span class="m">30</span>

<span class="c"># binlog filter config
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">druid</span>.<span class="n">ddl</span> = <span class="n">true</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">query</span>.<span class="n">dcl</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">query</span>.<span class="n">dml</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">query</span>.<span class="n">ddl</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">table</span>.<span class="n">error</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">rows</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">filter</span>.<span class="n">transaction</span>.<span class="n">entry</span> = <span class="n">false</span>

<span class="c"># binlog format/image check
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">binlog</span>.<span class="n">format</span> = <span class="n">ROW</span>,<span class="n">STATEMENT</span>,<span class="n">MIXED</span> 
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">binlog</span>.<span class="n">image</span> = <span class="n">FULL</span>,<span class="n">MINIMAL</span>,<span class="n">NOBLOB</span>

<span class="c"># binlog ddl isolation
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">get</span>.<span class="n">ddl</span>.<span class="n">isolation</span> = <span class="n">false</span>

<span class="c"># parallel parser config
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">parser</span>.<span class="n">parallel</span> = <span class="n">true</span>
<span class="c">## concurrent thread number, default 60% available processors, suggest not to exceed Runtime.getRuntime().availableProcessors()
#canal.instance.parser.parallelThreadSize = 16
## disruptor ringbuffer size, must be power of 2
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">parser</span>.<span class="n">parallelBufferSize</span> = <span class="m">256</span>

<span class="c"># table meta tsdb info
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">enable</span> = <span class="n">true</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">dir</span> = ${<span class="n">canal</span>.<span class="n">file</span>.<span class="n">data</span>.<span class="n">dir</span>:../<span class="n">conf</span>}/${<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">destination</span>:}
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">url</span> = <span class="n">jdbc</span>:<span class="n">h2</span>:${<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">dir</span>}/<span class="n">h2</span>;<span class="n">CACHE_SIZE</span>=<span class="m">1000</span>;<span class="n">MODE</span>=<span class="n">MYSQL</span>;
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">dbUsername</span> = <span class="n">canal</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">dbPassword</span> = <span class="n">canal</span>
<span class="c"># dump snapshot interval, default 24 hour
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">snapshot</span>.<span class="n">interval</span> = <span class="m">24</span>
<span class="c"># purge snapshot expire , default 360 hour(15 days)
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">snapshot</span>.<span class="n">expire</span> = <span class="m">360</span>

<span class="c"># aliyun ak/sk , support rds/mq
</span><span class="n">canal</span>.<span class="n">aliyun</span>.<span class="n">accessKey</span> =
<span class="n">canal</span>.<span class="n">aliyun</span>.<span class="n">secretKey</span> =

<span class="c">#################################################
######### 		destinations		#############
#################################################
</span><span class="n">canal</span>.<span class="n">destinations</span> =
<span class="c"># conf root dir
</span><span class="n">canal</span>.<span class="n">conf</span>.<span class="n">dir</span> = ../<span class="n">conf</span>
<span class="c"># auto scan instance dir add/remove and start/stop instance
</span><span class="n">canal</span>.<span class="n">auto</span>.<span class="n">scan</span> = <span class="n">true</span>
<span class="n">canal</span>.<span class="n">auto</span>.<span class="n">scan</span>.<span class="n">interval</span> = <span class="m">5</span>

<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">tsdb</span>.<span class="n">spring</span>.<span class="n">xml</span> = <span class="n">classpath</span>:<span class="n">spring</span>/<span class="n">tsdb</span>/<span class="n">h2</span>-<span class="n">tsdb</span>.<span class="n">xml</span>
<span class="c">#canal.instance.tsdb.spring.xml = classpath:spring/tsdb/mysql-tsdb.xml
</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">global</span>.<span class="n">mode</span> = <span class="n">manager</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">global</span>.<span class="n">lazy</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">instance</span>.<span class="n">global</span>.<span class="n">manager</span>.<span class="n">address</span> = ${<span class="n">canal</span>.<span class="n">admin</span>.<span class="n">manager</span>}
<span class="c">#canal.instance.global.spring.xml = classpath:spring/memory-instance.xml
</span><span class="n">canal</span>.<span class="n">instance</span>.<span class="n">global</span>.<span class="n">spring</span>.<span class="n">xml</span> = <span class="n">classpath</span>:<span class="n">spring</span>/<span class="n">file</span>-<span class="n">instance</span>.<span class="n">xml</span>
<span class="c">#canal.instance.global.spring.xml = classpath:spring/default-instance.xml
</span>
<span class="c">##################################################
######### 		     MQ 		     #############
##################################################
</span><span class="n">canal</span>.<span class="n">mq</span>.<span class="n">servers</span> = <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">6667</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">retries</span> = <span class="m">0</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">batchSize</span> = <span class="m">16384</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">maxRequestSize</span> = <span class="m">1048576</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">lingerMs</span> = <span class="m">100</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">bufferMemory</span> = <span class="m">33554432</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">canalBatchSize</span> = <span class="m">50</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">canalGetTimeout</span> = <span class="m">100</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">flatMessage</span> = <span class="n">true</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">compressionType</span> = <span class="n">none</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">acks</span> = <span class="n">all</span>
<span class="c">#canal.mq.properties. =
</span><span class="n">canal</span>.<span class="n">mq</span>.<span class="n">producerGroup</span> = <span class="n">test</span>
<span class="c"># Set this value to "cloud", if you want open message trace feature in aliyun.
</span><span class="n">canal</span>.<span class="n">mq</span>.<span class="n">accessChannel</span> = <span class="n">local</span>
<span class="c"># aliyun mq namespace
#canal.mq.namespace =
</span>
<span class="c">##################################################
#########     Kafka Kerberos Info    #############
##################################################
</span><span class="n">canal</span>.<span class="n">mq</span>.<span class="n">kafka</span>.<span class="n">kerberos</span>.<span class="n">enable</span> = <span class="n">false</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">kafka</span>.<span class="n">kerberos</span>.<span class="n">krb5FilePath</span> = <span class="s2">"../conf/kerberos/krb5.conf"</span>
<span class="n">canal</span>.<span class="n">mq</span>.<span class="n">kafka</span>.<span class="n">kerberos</span>.<span class="n">jaasFilePath</span> = <span class="s2">"../conf/kerberos/jaas.conf"</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Canal Server Config - Hemin` Blog&amp;url=https://ohemin.github.io/posts/canal-server-config/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Canal Server Config - Hemin` Blog&amp;u=https://ohemin.github.io/posts/canal-server-config/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://ohemin.github.io/posts/canal-server-config/&amp;text=Canal Server Config - Hemin` Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/linux-usb-image/">Linux Usb Image</a><li><a href="/posts/canal-server-config/">Canal Server Config</a><li><a href="/posts/linux-vi-replace/">vi vim中的文本替换</a><li><a href="/posts/mac-mysql-install/">mac中安装MySQL数据库</a><li><a href="/posts/mysqldump-cmd/">MySQL数据备份命令mysqldump</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/develop/">develop</a> <a class="post-tag" href="/tags/environment/">environment</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/image/">image</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/updating/">updating</a> <a class="post-tag" href="/tags/idea/">idea</a> <a class="post-tag" href="/tags/security/">security</a></div></div></div><script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/centos8-development-of-machine/"><div class="card-body"> <em class="timeago small" data-ts="1654358400" > 2022-06-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Centos8 Development Of Machine</h3><div class="text-muted small"><p> 本人CentOS开发服务器换了块硬盘，因此需要重新安装一下，为了下次加快安装设置速度，把遇到的问题记录一下 CentOS8 初始安装介质是CentOS 8.2，从光盘或者U盘启动，进入安装程序： 语言：English 时区：Asia/Shanghai 根据需要选择安装软件 安装磁盘：sda1，如果空间不够选择清空磁盘 网络开关打开以太网 设置root密码（不设...</p></div></div></a></div><div class="card"> <a href="/posts/bash-pre-symbol/"><div class="card-body"> <em class="timeago small" data-ts="1653793260" > 2022-05-29 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>修改bash窗口前导提示</h3><div class="text-muted small"><p> 上次修改桌面布局后，terminal 窗口宽度变得较为固定，此时遇到一个问题是当我进入一个名称较长的目录后窗口的前导提示已经占据了一行中大半的空间，体验非常不好，于是决定动手修改一下。 先查看一下当前所使用的前导格式 1 2 echo $PS1 &amp;gt; \h:\W \u\$ 这里贴一下格式说明： 变量 描述 ...</p></div></div></a></div><div class="card"> <a href="/posts/flink-cdc-2.2/"><div class="card-body"> <em class="timeago small" data-ts="1653667200" > 2022-05-28 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Flink CDC 2.2</h3><div class="text-muted small"><p> Flink CDC 发布了2.2版本，这次新增加了4种数据源：OceanBase，PolarDB-X，SqlServer，TiDB；这其中的三种：OceanBase，SqlServer，TiDB应该算是比较常见的数据库了，而且对于MySQL的同步支持动态加表，也就是说可以在原来的同步不中断的情况下增加对新表的同步，可以说是一个非常重要的功能。 to be continue…</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/centos-docker-install&config/" class="btn btn-outline-primary" prompt="上一篇"><p>CentOS下的docker安装与配置</p></a> <a href="/posts/linux-usb-image/" class="btn btn-outline-primary" prompt="下一篇"><p>Linux Usb Image</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/MinHe15638041">Min He</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/develop/">develop</a> <a class="post-tag" href="/tags/environment/">environment</a> <a class="post-tag" href="/tags/architecture/">architecture</a> <a class="post-tag" href="/tags/image/">image</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/updating/">updating</a> <a class="post-tag" href="/tags/idea/">idea</a> <a class="post-tag" href="/tags/security/">security</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="/assets/lib/simple-jekyll-search-1.10.0/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="/assets/lib/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script> <script src="/assets/lib/lozad-1.16.0/lozad.min.js"></script> <script src="/assets/lib/clipboard-2.0.9/clipboard.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/dayjs.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/locale/en.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/relativeTime.min.js"></script> <script src="/assets/lib/dayjs-1.10.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="/assets/lib/bootstrap-4.6.1/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
